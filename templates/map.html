<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–æ—Ä—Å–∫–æ–π –±–æ–π</title>
<style>
    .grid-container {
        display: grid;
        grid-template-columns: repeat(10, 50px);
        grid-template-rows: repeat(10, 50px);
        gap: 1px;
    }
    .grid-item {
        width: 50px;
        height: 50px;
        background-color: lightblue;
        border: 1px solid black;
        text-align: center;
        line-height: 50px;
    }
</style>
</head>
<body>
<h1>–ú–æ—Ä—Å–∫–æ–π –±–æ–π</h1>
<h2>–ú–æ–∏ –∫–æ—Ä–∞–±–ª–∏</h2>
<div class="grid-container" id="my-grid"></div>
<h2>–ö–æ—Ä–∞–±–ª–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</h2>
<div class="grid-container" id="enemy-grid"></div>

<script>
    const playerGrid = document.getElementById('my-grid');
    const computerGrid = document.getElementById('enemy-grid');
    const gridSize = 10;

    // –°–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–µ—Ç–æ–∫
    const EMPTY_CELL = '‚¨ú';
    const SHIP_CELL = '‚õ¥Ô∏è';
    const HIT_CELL = 'üí•';
    const MISS_CELL = '‚ùå';

    // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∫–∏
    function createGrid(container, clickHandler) {
        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                const gridItem = document.createElement('div');
                gridItem.classList.add('grid-item');
                gridItem.dataset.row = i;
                gridItem.dataset.col = j;
                gridItem.addEventListener('click', clickHandler);
                container.appendChild(gridItem);
            }
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —è—á–µ–π–∫–∏
    function updateCellState(gridItem, state) {
        switch (state) {
            case 'empty':
                gridItem.textContent = EMPTY_CELL;
                break;
            case 'ship':
                gridItem.textContent = SHIP_CELL;
                break;
            case 'hit':
                gridItem.textContent = HIT_CELL;
                break;
            case 'miss':
                gridItem.textContent = MISS_CELL;
                break;
            default:
                gridItem.textContent = ''; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–∞—è —è—á–µ–π–∫–∞
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —è—á–µ–π–∫–µ
    function cellClickHandler(event) {
        const row = event.target.dataset.row;
        const col = event.target.dataset.col;
        console.log(`Clicked on cell (${row}, ${col})`);
        const playerId = 'player'; // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–≥—Ä–æ–∫–∞
        sendTurn(playerId, row, col);
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª–æ–∂–µ–Ω–∏–∏ –∫–æ—Ä–∞–±–ª–µ–π —Å —Å–µ—Ä–≤–µ—Ä–∞
    function fetchMap(playerId) {
        fetch(`/map?playerId=${playerId}`)
            .then(response => response.json())
            .then(data => {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª–æ–∂–µ–Ω–∏–∏ –∫–æ—Ä–∞–±–ª–µ–π
                console.log(data);
                // –ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —è—á–µ–µ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
                data.forEach(cell => {
                    const row = cell.row;
                    const col = cell.col;
                    const state = cell.state;
                    const grid = playerId === 'player' ? playerGrid : computerGrid;
                    const gridItem = grid.querySelector(`[data-row='${row}'][data-col='${col}']`);
                    updateCellState(gridItem, state);
                });
            })
            .catch(error => {
                console.error('Error fetching map:', error);
            });
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–µ—Ç–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    function sendTurn(playerId, row, col) {
        fetch('/turn', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                playerId: playerId,
                row: row,
                col: col
            })
        })
        .then(response => response.json())
        .then(data => {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
            console.log(data);
        })
        .catch(error => {
            console.error('Error sending turn:', error);
        });
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–æ–∫
    createGrid(playerGrid, cellClickHandler);
    createGrid(computerGrid, () => {});
    fetchMap('player');
    fetchMap('computer');
</script>
</body>
</html>
